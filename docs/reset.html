<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RecipeSite — Reset Password</title>
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/login.css" />
  <script>
    window.ENV_SUPABASE_URL = 'https://bhqeasmtrdfqncliipki.supabase.co/';
    window.ENV_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJocWVhc210cmRmcW5jbGlpcGtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwNzQ4NzgsImV4cCI6MjA3NzY1MDg3OH0.249y8yGBYKgcvnoKkdTft94Mu74kbO_Ioso2HFrTFpg';
  </script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"
        onload="
          try {
            window.supabase = window.supabase.createClient(
              window.ENV_SUPABASE_URL,
              window.ENV_SUPABASE_KEY,
              { auth:{ persistSession:true, autoRefreshToken:true } }
            );
            console.log('[supabase] ready?', !!window.supabase);
          } catch(e) { console.error('[supabase] init error', e); }
        "></script>
  <script src="js/common.js" defer></script>
</head>
<body class="auth-body">
<main class="auth-wrap">
  <div class="auth-card">
    <div class="auth-brand"><svg width="28" height="28" viewBox="0 0 24 24"><path fill="currentColor" d="M8 3a1 1 0 0 0-1 1v2h10a1 1 0 1 1 0 2H7v2h8.5a3.5 3.5 0 1 1 0 7H12v2h4.5a5.5 5.5 0 0 0 0-11H6V4a1 1 0 0 1 1-1h1z"/></svg><span>RecipeSite</span></div>
    <h1>Set a new password</h1>
    <form id="resetForm" class="auth-form" novalidate>
      <label class="field"><span>New password</span><input id="newPw1" type="password" required placeholder="New password" /></label>
      <label class="field"><span>Confirm</span><input id="newPw2" type="password" required placeholder="Repeat password" /></label>
      <button class="btn full" type="submit">Update password</button>
    </form>
    <div class="auth-footer"><a class="link" href="index.html">← Back to sign in</a></div>
  </div>
</main>
<script>
  document.getElementById('resetForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const p1=document.getElementById('newPw1').value, p2=document.getElementById('newPw2').value;
    if (p1!==p2) return alert('Passwords do not match');
    try{
      const { data: sess } = await supabase.auth.getSession();
      if (!sess?.session) return alert('Reset link invalid/expired. Request a new one.');
      const { error } = await supabase.auth.updateUser({ password: p1 });
      if (error) throw error;
      alert('Password updated. Sign in now.');
      location.href='index.html';
    }catch(err){ alert(err.message || 'Failed to update password'); }
  });
</script>
</body>
</html>
