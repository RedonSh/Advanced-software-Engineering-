<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RecipeSite — Recipe</title>

  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/recipe.css" />

  <!-- ENV -->
  <script>
    window.ENV_SUPABASE_URL = 'https://bhqeasmtrdfqncliipki.supabase.co/';
    window.ENV_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJocWVhc210cmRmcW5jbGlpcGtpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwNzQ4NzgsImV4cCI6MjA3NzY1MDg3OH0.249y8yGBYKgcvnoKkdTft94Mu74kbO_Ioso2HFrTFpg';
  </script>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"
          onload="window.supabase = window.supabase.createClient(ENV_SUPABASE_URL, ENV_SUPABASE_KEY, {auth:{persistSession:true, autoRefreshToken:true}})"></script>

  <!-- Core -->
  <script src="js/common.js" defer></script>
</head>
<body>
  <header class="site-head">
    <div class="container">
      <nav class="nav"><a href="recipes.html#browse">← Back to Browse</a></nav>
    </div>
  </header>

  <main class="container">
    <div id="alert" class="alert" hidden style="margin:12px 0;padding:10px 12px;border:1px solid #e11;border-radius:10px;background:#fee;color:#700"></div>
    <article id="detail" class="recipe-detail">Loading…</article>
  </main>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    const alertBox = document.getElementById('alert');
    const showAlert = (m)=>{ alertBox.textContent=m; alertBox.hidden=false; };
    const el = document.getElementById('detail');

    try{
      if (!window.RecipeSite) throw new Error('App core not loaded.');
      const id = new URLSearchParams(location.search).get('id');
      if (!id) { el.innerHTML='<p class="muted">Missing recipe id.</p>'; return; }

      const r = await RecipeSite.getRecipeById(id);
      if (!r) { el.innerHTML = '<p class="muted">Recipe not found (DB returned nothing).</p>'; return; }

      const imgHtml = r.image ? `<img class="hero-img" src="${r.image}" alt="${r.title}" />`
                              : `<div class="noimg-badge" style="margin:8px 0">No image</div>`;

      el.innerHTML = `
        <header class="hero">
          ${imgHtml}
          <div class="hero-meta">
            <h1>${r.title}</h1>
            <span class="pill">${r.category || ''}</span>
          </div>
        </header>

        <section class="card">
          <h2>Ingredients</h2>
          <ul class="ingredients">
            ${(r.ingredients || []).map(i => `<li>${i}</li>`).join('') || '<li class="muted">No ingredients listed.</li>'}
          </ul>
        </section>

        <section class="card">
          <h2>Steps</h2>
          <ol class="steps">
            ${(r.steps || []).map(s => `<li>${s}</li>`).join('') || '<li class="muted">No steps provided.</li>'}
          </ol>
        </section>

        <section class="card">
          <h2>Nutrition (per serving)</h2>
          <ul class="nutrition">
            <li><strong>Calories:</strong> ${r.calories ?? 0}</li>
            <li><strong>Protein:</strong> ${r.protein ?? 0} g</li>
            <li><strong>Carbs:</strong> ${r.carbs ?? 0} g</li>
            <li><strong>Fat:</strong> ${r.fat ?? 0} g</li>
          </ul>
        </section>
      `;
    }catch(e){
      showAlert(e.message || String(e));
      document.getElementById('detail').innerHTML = '';
    }
  });
  </script>
</body>
</html>
